# 项目概述

---

## 项目简介

`Q2P` 是一个基于 UDP 协议实现的点对点（P2P）网络通信库，旨在通过简洁的事件驱动和数据传输协议，支持多个节点之间的连接和数据交换。该库采用 Go 语言编写，提供了一种简洁的方式来实现 P2P 网络中的设备连接、通信和数据传输。

## 主要功能

- **网络事件驱动**：支持多种网络事件（如连接请求、数据传输等）处理。
- **高效的数据传输**：基于 UDP 协议进行高效的数据传输，保证数据的可靠传输。
- **传输超时与重试**：在数据传输过程中对丢包、超时等问题进行处理，保证高可用性。
- **数据分片与合并**：支持大数据量的分片传输和传输失败后的自动重试。

## 技术栈

- **编程语言**：Go 语言（Go 1.22+）
- **网络协议**：UDP（用户数据报协议）
- **数据传输机制**：分片传输、超时重试机制

## 目标

- 实现高效、可靠的点对点通信，适用于多种实时应用场景，如文件传输、即时消息等。
- 提供一个简洁的 API，使开发者能够轻松集成 P2P 通信功能。
- 支持大规模节点连接，并通过网络事件和回调机制进行高效管理。

## 项目结构

以下是 `Q2P` 项目的目录结构：

```
/q2p
│
├── config.go               # 配置文件，管理系统的全局配置参数
├── event.go                # 定义了各种网络事件的常量
├── peer.go                 # 定义了 Peer（节点）结构及其与其他节点的连接、数据传输逻辑
├── q2p.go                  # 定义了节点间的网络事件处理逻辑，负责数据包的发送、接收与处理
├── transmission.go         # 实现了数据的分片、发送、接收和重试机制
├── q2p_test.go             # 用于测试整个 P2P 网络通信过程的测试文件
├── go.mod                  # Go 依赖管理文件，定义项目的模块及依赖关系
```

### 文件说明

1. **`config.go`**
   - **作用**：定义了系统的全局配置，主要是设置连接的最大节点数（`connection_num`）等。提供了 `Set_connection_num()` 函数用于设置连接的最大节点数。
   - **用途**：`config.go` 提供了一些基础的配置值，可以根据需要进行调整。

2. **`event.go`**
   - **作用**：定义了多个网络事件的常量，如 `JOIN`、`TOUCHREQUEST`、`TRANSPORT` 等。这些常量用于标识节点之间通信的不同状态或请求。
   - **用途**：通过这些事件常量，可以清晰地标识每一个数据包或请求所对应的操作类型。代码中的各个部分通过这些常量来判断和处理不同类型的事件。

3. **`peer.go`**
   - **作用**：定义了 `Peer_T` 类型及其相关方法，表示一个 P2P 网络中的节点。主要实现了节点的创建、监听、连接请求、数据收发等功能。
   - **用途**：`peer.go` 处理节点与节点之间的连接与数据通信，负责接受网络请求并对其进行相应处理，其中`Run()` 方法用来启动 UDP 监听，并处理来自其他节点的数据。

4. **`q2p.go`**
   - **作用**：负责网络事件的处理逻辑，基于事件类型调用相应的函数处理数据传输。包括对各种事件的处理，如 `JOIN`、`CONNECT`、`TRANSPORT` 等，并负责对数据进行处理、传输及其错误处理。
   - **用途**：`q2p.go` 文件是项目的核心，负责网络层的事件处理。节点间的数据传输、连接建立和网络事件的回调都通过该文件中的方法进行处理。

5. **`transmission.go`**
   - **作用**：实现了数据的分片传输和错误回报机制。主要功能包括数据的拆分（分片）、重新组装。它通过维护数据包的序号（SYN）来确保数据包的顺序。
   - **用途**：对于大数据量的传输，`transmission.go` 保证了数据能够被分片处理，并且能够在数据缺失情况下，向发送者发送错误信息，由发送者决定如何进行后续处理,从而实现数据的可靠传输。

6. **`q2p_test.go`**
   - **作用**：用于测试整个 P2P 网络的通信流程。它模拟了节点的启动、数据传输等过程，并通过回调函数验证传输的数据是否正确。
   - **用途**：通过单元测试文件，开发者可以确保各个模块在不同情况下的正常运行，确保数据传输的正确性和可靠性。

7. **`go.mod`**
   - **作用**：Go 依赖管理文件，用于指定该项目的模块及其依赖包。它定义了所需的 Go 版本以及项目所依赖的外部包。
   - **用途**：Go 模块管理文件，确保项目能够正确地引入和管理其依赖。

---

## 跳转

请继续阅读以下章节以了解详细的架构设计和工作原理：[架构设计与原理](02_architecture_and_principles.md)。
